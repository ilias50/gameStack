server:
  port: 8083

spring:
  application:
    name: gateway-service
  cloud:
    gateway:
      server:
        webflux:
          # Configuration CORS conservée
          globalcors:
            cors-configurations:
              '[/**]':
                allowedOriginPatterns: "*"
                allowedMethods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - OPTIONS
                allowedHeaders: "*"
                allowCredentials: true

          discovery:
            locator:
              # Active le localisateur de découverte, nécessaire pour la validation des URIs lb://
              enabled: true

      routes:
        # 1. Route d'Authentification : ID 'auth-service' et URI lb://
        - id: auth-service
          uri: ${AUTH_SERVICE_URI:lb://AUTH-SERVICE}
          predicates:
            - Path=/api/auth/**
          filters:
            # Conserver le filtre StripPrefix pour enlever /api
            - StripPrefix=1

        # 2. Route de Jeux : AJOUT du StripPrefix pour satisfaire les tests et la logique
        - id: games_route
          uri: ${GAMES_SERVICE_URI:lb://GAMES-SERVICE}
          predicates:
            - Path=/api/games/**
          filters:
            # Filtre StripPrefix ajouté
            - StripPrefix=1

        # 3. Route de Collections : AJOUT du StripPrefix pour satisfaire les tests et la logique
        - id: collections_route
          uri: ${COLLECTION_SERVICE_URI:lb://COLLECTION-SERVICE}
          predicates:
            - Path=/api/collections/**
          filters:
            # Filtre StripPrefix ajouté
            - StripPrefix=1

        # 4. Suppression de la route de test (dummy_test_route)
        # Ces routes sont souvent définies dans les tests eux-mêmes et interfèrent avec shouldDefineAllRequiredRoutes.
